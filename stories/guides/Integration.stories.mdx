import { Meta } from '@storybook/blocks'

<Meta title="Guides/Framework Integration" />

# Framework Integration Guide

Complete guides for integrating staple-css with popular frameworks and build tools.

---

## Next.js (App Router)

### Installation

```bash
npm install @staple-css/tokens @staple-css/primitives
```

### Setup

1. **Import CSS in root layout** (`app/layout.tsx`):

```tsx
import '@staple-css/tokens/all.css'
import '@staple-css/primitives/primitives.css'

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>{children}</body>
    </html>
  )
}
```

2. **Use primitives in any component**:

```tsx
import { Box, Text, Column } from '@staple-css/primitives'

export default function HomePage() {
  return (
    <Column gap={4} pad={6}>
      <Text as="h1" size={6} weight="bold">
        Welcome to Next.js + staple-css
      </Text>
      <Box pad={4} radius={2} shadow={1}>
        <Text>Your content here</Text>
      </Box>
    </Column>
  )
}
```

### Server Components

All primitives work in Next.js Server Components! No client-side JavaScript required for static layouts.

### TypeScript

Full TypeScript support out of the box:

```tsx
import type { BoxProps } from '@staple-css/primitives'

const MyCard = (props: BoxProps) => {
  return <Box pad={4} radius={2} shadow={1} {...props} />
}
```

---

## Next.js (Pages Router)

### Setup

1. **Import CSS in `_app.tsx`**:

```tsx
import '@staple-css/tokens/all.css'
import '@staple-css/primitives/primitives.css'
import type { AppProps } from 'next/app'

export default function App({ Component, pageProps }: AppProps) {
  return <Component {...pageProps} />
}
```

2. **Use in pages**:

```tsx
import { Container, Text } from '@staple-css/primitives'

export default function HomePage() {
  return (
    <Container size="lg" center>
      <Text size={5} weight="bold">
        Hello World
      </Text>
    </Container>
  )
}
```

---

## Remix

### Installation

```bash
npm install @staple-css/tokens @staple-css/primitives
```

### Setup

1. **Import CSS in root** (`app/root.tsx`):

```tsx
import tokensStyles from '@staple-css/tokens/all.css'
import primitivesStyles from '@staple-css/primitives/primitives.css'

export function links() {
  return [
    { rel: 'stylesheet', href: tokensStyles },
    { rel: 'stylesheet', href: primitivesStyles },
  ]
}

export default function App() {
  return (
    <html lang="en">
      <head>
        <Links />
      </head>
      <body>
        <Outlet />
        <Scripts />
      </body>
    </html>
  )
}
```

2. **Use in routes**:

```tsx
import { Box, Column, Text } from '@staple-css/primitives'

export default function Index() {
  return (
    <Column gap={4} pad={6}>
      <Text size={6} weight="bold">
        Remix + staple-css
      </Text>
      <Box pad={4} radius={2} shadow={1}>
        <Text>Lightning fast!</Text>
      </Box>
    </Column>
  )
}
```

---

## Vite + React

### Installation

```bash
npm install @staple-css/tokens @staple-css/primitives
```

### Setup

1. **Import CSS in `main.tsx`**:

```tsx
import '@staple-css/tokens/all.css'
import '@staple-css/primitives/primitives.css'
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

2. **Use in components**:

```tsx
import { Box, Text, Row } from '@staple-css/primitives'

function App() {
  return (
    <Box pad={6}>
      <Row gap={4} align="center">
        <Text size={5} weight="bold">
          Vite + staple-css
        </Text>
      </Row>
    </Box>
  )
}
```

### TypeScript Support

Create `vite-env.d.ts`:

```typescript
/// <reference types="vite/client" />
```

---

## Create React App

### Installation

```bash
npm install @staple-css/tokens @staple-css/primitives
```

### Setup

1. **Import CSS in `index.tsx`**:

```tsx
import '@staple-css/tokens/all.css'
import '@staple-css/primitives/primitives.css'
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App'

const root = ReactDOM.createRoot(document.getElementById('root') as HTMLElement)
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
)
```

2. **Use in components** (same as Vite example above)

---

## Astro

### Installation

```bash
npm install @staple-css/tokens @staple-css/primitives
```

### Setup

1. **Import CSS in layout** (`.astro` file):

```astro
---
import '@staple-css/tokens/all.css'
import '@staple-css/primitives/primitives.css'
---

<html>
  <head>
    <title>My Site</title>
  </head>
  <body>
    <slot />
  </body>
</html>
```

2. **Use with React islands**:

```astro
---
import { Box } from '@staple-css/primitives'
---

<Box client:load pad={4} radius={2} shadow={1}>
  <h1>Astro + staple-css</h1>
</Box>
```

### Static CSS

All CSS is static! No JavaScript required for styling. Perfect for Astro's partial hydration.

---

## TypeScript Configuration

### Strict Type Checking

Enable strict mode in `tsconfig.json`:

```json
{
  "compilerOptions": {
    "strict": true,
    "moduleResolution": "bundler",
    "types": ["@staple-css/primitives"]
  }
}
```

### Type Imports

Import types for props:

```tsx
import type { BoxProps, TextProps, FlexProps } from '@staple-css/primitives'

interface CardProps extends BoxProps {
  title: string
}
```

---

## Dark Mode Integration

### React Context

Create a theme provider:

```tsx
import { createContext, useContext, useState, useEffect } from 'react'

type Theme = 'light' | 'dark'

const ThemeContext = createContext<{
  theme: Theme
  setTheme: (theme: Theme) => void
}>({ theme: 'light', setTheme: () => {} })

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [theme, setTheme] = useState<Theme>('light')

  useEffect(() => {
    document.documentElement.dataset.theme = theme
  }, [theme])

  return (
    <ThemeContext.Provider value={{ theme, setTheme }}>
      {children}
    </ThemeContext.Provider>
  )
}

export const useTheme = () => useContext(ThemeContext)
```

Use in components:

```tsx
function ThemeToggle() {
  const { theme, setTheme } = useTheme()

  return (
    <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')}>
      {theme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light'}
    </button>
  )
}
```

---

## Performance Tips

### Code Splitting

Import only what you need:

```tsx
// ‚úÖ Good - tree-shakeable
import { Box, Text } from '@staple-css/primitives'

// ‚ùå Avoid - imports everything
import * as Primitives from '@staple-css/primitives'
```

### CSS Imports

Import specific CSS files if you don't need everything:

```tsx
// Minimal - just tokens
import '@staple-css/tokens/tokens.css'

// With themes
import '@staple-css/tokens/tokens.css'
import '@staple-css/tokens/themes.css'

// Everything
import '@staple-css/tokens/all.css'
```

### Bundle Size

- **Tokens CSS**: ~8KB gzipped
- **Primitives CSS**: ~4KB gzipped
- **Primitives JS**: ~6KB gzipped
- **Total**: ~18KB gzipped

Zero runtime CSS generation = consistent performance!

---

## Migration from Other Systems

### From Tailwind CSS

Replace utility classes with props:

```tsx
// Before (Tailwind)
<div className="p-4 rounded-md shadow-sm bg-white">
  <h1 className="text-2xl font-bold">Title</h1>
</div>

// After (staple-css)
<Box pad={4} radius={2} shadow={1}>
  <Text as="h1" size={4} weight="bold">
    Title
  </Text>
</Box>
```

### From CSS Modules

Replace CSS files with primitives:

```tsx
// Before (CSS Modules)
import styles from './Card.module.css'
<div className={styles.card}>
  <h2 className={styles.title}>Title</h2>
</div>

// After (staple-css)
<Card pad={4} radius={2} shadow={1}>
  <Text as="h2" size={4} weight="bold">
    Title
  </Text>
</Card>
```

### From Styled Components

Replace styled components with primitives:

```tsx
// Before (styled-components)
const StyledBox = styled.div`
  padding: 16px;
  border-radius: 8px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
`

// After (staple-css)
<Box pad={4} radius={2} shadow={1} />
```

---

## Custom Token Generation

### Create Custom Tokens

Use the CLI to generate custom token sets:

```bash
# Initialize config
npx @staple-css/tokens init

# Edit staple.config.json with your values
{
  "prefix": "my",
  "colors": {
    "brand": "#ff6b00",
    "accent": "#00d4ff"
  },
  "space": {
    "xs": "0.5rem",
    "sm": "1rem",
    "md": "1.5rem",
    "lg": "2rem"
  }
}

# Generate CSS
npx @staple-css/tokens generate staple.config.json --output custom-tokens.css
```

Import your custom tokens:

```tsx
import './custom-tokens.css'
```

---

## Best Practices

### Component Composition

Build reusable components:

```tsx
const PageHeader = ({ title, description }: { title: string; description?: string }) => (
  <Column gap={2} pad={5} style={{ borderBottom: '1px solid var(--st-color-border)' }}>
    <Text as="h1" size={5} weight="bold">
      {title}
    </Text>
    {description && (
      <Text size={2} tone="muted">
        {description}
      </Text>
    )}
  </Column>
)
```

### Responsive Design

Use responsive props:

```tsx
<Grid
  cols={{ base: 1, sm: 2, md: 3, lg: 4 }}
  gap={{ base: 2, md: 4 }}
>
  {items.map(item => <Card key={item.id} {...item} />)}
</Grid>
```

### Type Safety

Leverage TypeScript for prop validation:

```tsx
import type { Space, Radius } from '@staple-css/primitives'

interface CardProps {
  pad?: Space  // Only valid space tokens (0-8)
  radius?: Radius  // Only valid radius tokens (0-4)
}
```

---

## Troubleshooting

### CSS Not Loading

Ensure CSS is imported before any components:

```tsx
// ‚úÖ Correct order
import '@staple-css/tokens/all.css'
import '@staple-css/primitives/primitives.css'
import { Box } from '@staple-css/primitives'

// ‚ùå Wrong order
import { Box } from '@staple-css/primitives'
import '@staple-css/tokens/all.css'  // Too late!
```

### TypeScript Errors

Update `tsconfig.json`:

```json
{
  "compilerOptions": {
    "moduleResolution": "bundler",  // or "node16"
    "jsx": "react-jsx",
    "types": ["react", "@staple-css/primitives"]
  }
}
```

### Styling Conflicts

staple-css uses low-specificity selectors. If styles aren't applying, check for conflicting CSS:

```css
/* Your global CSS - too specific! */
div { padding: 0 !important; }

/* Solution: Be less specific or use :where() */
:where(div) { padding: 0; }
```

---

## Getting Help

- **Documentation**: [staple-css.dev](https://staple-lab.github.io/staple-css/)
- **GitHub**: [github.com/staple-lab/staple-css](https://github.com/staple-lab/staple-css)
- **Issues**: [Report bugs](https://github.com/staple-lab/staple-css/issues)
- **Storybook**: Browse interactive examples

---

## What's Next?

- Explore the [Token Reference](/story/tokens-colors--semantic-colors) for all available design tokens
- Check out [Complete App Examples](/story/examples-dashboard-app--complete-dashboard)
- Learn about [Dark Mode](/story/guides-dark-mode--basic-dark-mode) implementation
- Read the [Performance Guide](#performance-tips) for optimization tips
